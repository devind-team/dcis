# Правила расчета ячеек

## Изменение Value

### Право изменять значение ячеек

Предварительной проверкой должен служить последний статус, значение которого 
должно быть `Document.last_status.editable == True` в таблице **dcis_status.**

Значение может измениться
- `Cell.editable == True` - ячейке может быть установлено значение
- `Cell.formula is not None` - значение ячейки устанавливается только в результате расчета формул

После чего проверяется возможность редактирования по привилегиям:
- `dcis.change_value` - пользователь обладает глобальной привилегией для изменения значения
- `change_value` - локальная привилегия, позволяющая менять значения документа в выбранном периоде
- `Period.multiple == False` and `user_divisions in Period.divisions` and `Document.object_id is None` - в периоде 
  может быть только один документ с одной версией и пользователь присутствует в дивизионе
  - `Row.parent_id is None` and `Row.division_id is None` - изменение первого уровня
  - `Row.parent_id is not None` and `Row.division_id in user_divisions` - изменение строк второго и глубже уровней,
    при этом строка должна быть добавлена пользователем, который находиться в дивизионе
- `Period.multiple == True` and `Document.object_id == Period.user_division` - на каждый дивизион создаются свои
  документы, в которых и происходит изменение значений

> `Period.multiple` - флаг влияющий на поведение сбора. Если значения **True**, то у каждого дивизиона есть свои
> документы с версиями. Если значение **False**, на все сборы предполагаются различные версии одного документа.


### Ссылки на связанные файлы

- [Мутация для изменения значения ячейки](../server/apps/dcis/schema/mutations/value_mutations.py)
- [Сервис для изменения значений](../server/apps/dcis/services/value_services.py)
- [Привилегия для изменения значения](../server/apps/dcis/permissions/value_permissions.py)

## Изменение Cell

### Право изменять метазначения ячейки

## Ссылки на связанные файлы:

- [Кеш контейнер для хранения зависимостей](../server/apps/dcis/helpers/sheet_cache.py)